<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hosting & Jualan Files — Demo</title>
  <meta name="description" content="Demo frontend untuk jualan file (digital goods) — admin tambah file, pelanggan beli, dapat link download (simulasi)." />
  <style>
    /* Simple modern styling (no frameworks) */
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#7dd3fc;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; margin:0; background:linear-gradient(180deg,#071025 0%, #071726 60%); color:#e6eef6; -webkit-font-smoothing:antialiased}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid rgba(255,255,255,0.03)}
    h1{font-size:18px;margin:0;color:var(--accent)}
    .container{max-width:1100px;margin:28px auto;padding:0 18px}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:20px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02)}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .product{background:var(--glass);padding:12px;border-radius:10px}
    .product h3{margin:0 0 6px 0;font-size:15px}
    .product p{margin:0;color:var(--muted);font-size:13px}
    .price{font-weight:700;margin-top:8px}
    button{background:linear-gradient(90deg,#1f6feb,#7dd3fc);border:none;padding:8px 12px;border-radius:8px;color:#04233b;font-weight:600;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
    .cart-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
    .muted{color:var(--muted);font-size:13px}
    form .row{display:flex;gap:8px}
    input[type=text],input[type=number],input[type=email]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    input[type=file]{color:var(--muted)}
    footer{margin:36px 0;color:var(--muted);font-size:13px;text-align:center}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(125,211,252,0.12);color:var(--accent);font-weight:600;font-size:12px}
    small.note{display:block;margin-top:8px;color:var(--muted);font-size:12px}
    @media (max-width:900px){.grid{grid-template-columns:1fr} .container{padding:0 12px}}
  </style>
</head>
<body>
  <header>
    <h1>Hosting Jualan Files — Demo</h1>
    <div class="badge">Frontend-only • Simulasi</div>
  </header>  <main class="container">
    <div class="grid">
      <section>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <h2 style="margin:0 0 6px 0">Produk Digital</h2>
              <div class="muted">Tambahkan file lewat admin, pelanggan dapat membayar dan download (simulasi)</div>
            </div>
            <div>
              <button id="toggle-admin" class="secondary">Mode Admin</button>
            </div>
          </div><div id="admin-panel" style="display:none;margin-bottom:16px">
        <form id="add-product-form">
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <input id="prod-title" type="text" placeholder="Nama produk (contoh: eBook React)" required />
            <input id="prod-price" type="number" placeholder="Harga (Rp)" min="0" required />
          </div>
          <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
            <input id="prod-file" type="file" required />
            <button type="submit">Tambah Produk</button>
          </div>
          <small class="muted">File disimpan hanya di browser (memori) — tidak aman untuk produksi.</small>
        </form>
      </div>

      <div id="products" class="product-grid">
        <!-- produk akan dirender di sini -->
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h3 style="margin-top:0">Riwayat Pembelian (session)</h3>
      <div id="orders-list">
        <div class="muted">Belum ada pembelian.</div>
      </div>
    </div>
  </section>

  <aside class="card">
    <h3 style="margin-top:0">Keranjang</h3>
    <div id="cart-list">
      <div class="muted">Keranjang kosong</div>
    </div>
    <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="muted">Total:</div>
        <div id="cart-total" style="font-weight:700">Rp 0</div>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0" />

    <form id="checkout-form">
      <div style="margin-bottom:8px">
        <label class="muted">Email pembeli</label>
        <input id="buyer-email" type="email" placeholder="email@contoh.com" required />
      </div>
      <button type="submit">Bayar (simulasi)</button>
      <small class="note">Ini hanyalah simulasi: tidak ada proses pembayaran nyata. Gunakan Stripe/PayPal di produksi.</small>
    </form>

  </aside>
</div>

<footer>
  <div>Catatan: solusi ini menyimpan file hanya di memori browser (Blob). Untuk hosting nyata, Anda butuh backend + storage (S3, GCS) + gateway pembayaran.</div>
</footer>

  </main>  <script>
    /* Simple frontend-only store for demo purposes
       - Admin dapat menambah produk (file disimpan sebagai Blob di memori)
       - Produk tampil di grid, bisa ditambahkan ke cart
       - Checkout mensimulasikan pembayaran dan memberikan link download (Blob URL)
       - Links di-revoke setelah 10 menit (client-side)
       - NOT FOR PRODUCTION
    */

    // Data
    const products = JSON.parse(localStorage.getItem('demo_products') || '[]');
    const orders = JSON.parse(sessionStorage.getItem('demo_orders') || '[]');

    // Helpers
    const rupiah = n => 'Rp ' + Number(n).toLocaleString('id-ID');

    // Elements
    const productsEl = document.getElementById('products');
    const cartListEl = document.getElementById('cart-list');
    const cartTotalEl = document.getElementById('cart-total');
    const checkoutForm = document.getElementById('checkout-form');
    const buyerEmail = document.getElementById('buyer-email');
    const ordersListEl = document.getElementById('orders-list');
    const adminPanel = document.getElementById('admin-panel');
    const toggleAdminBtn = document.getElementById('toggle-admin');
    const addProductForm = document.getElementById('add-product-form');

    // In-memory Blob map: productId => {blob, url}
    const blobMap = {};

    // cart: array of product ids
    let cart = [];

    function saveProducts(){
      localStorage.setItem('demo_products', JSON.stringify(products.map(p=>({id:p.id,title:p.title,price:p.price,filename:p.filename,filesize:p.filesize}))))
      // Note: blobs are not persisted; product files exist only in this page session
    }

    function renderProducts(){
      productsEl.innerHTML = '';
      if(products.length===0){
        productsEl.innerHTML = '<div class="muted">Belum ada produk. Aktifkan <b>Mode Admin</b> dan tambahkan file.</div>';
        return;
      }
      for(const p of products){
        const div = document.createElement('div'); div.className='product';
        div.innerHTML = `<h3>${escapeHtml(p.title)}</h3><p class="muted">${escapeHtml(p.filename)} • ${p.filesize} bytes</p><div class="price">${rupiah(p.price)}</div><div style="margin-top:8px"><button data-id="${p.id}">Beli / Tambah ke keranjang</button></div>`;
        productsEl.appendChild(div);
      }
      // bind
      productsEl.querySelectorAll('button[data-id]').forEach(btn=>btn.addEventListener('click',e=>{
        const id = e.currentTarget.dataset.id; addToCart(id);
      }));
    }

    function renderCart(){
      cartListEl.innerHTML='';
      if(cart.length===0){ cartListEl.innerHTML = '<div class="muted">Keranjang kosong</div>'; cartTotalEl.textContent='Rp 0'; return }
      let total=0;
      for(const id of cart){
        const p = products.find(x=>x.id===id);
        if(!p) continue;
        total += Number(p.price);
        const div = document.createElement('div'); div.className='cart-item';
        div.innerHTML = `<div><strong>${escapeHtml(p.title)}</strong><div class="muted">${escapeHtml(p.filename)}</div></div><div style="text-align:right">${rupiah(p.price)}<div style="margin-top:6px"><button class="secondary" data-remove="${p.id}">Hapus</button></div></div>`;
        cartListEl.appendChild(div);
      }
      cartListEl.querySelectorAll('button[data-remove]').forEach(b=>b.addEventListener('click',e=>{
        const id = e.currentTarget.dataset.remove; cart = cart.filter(x=>x!==id); renderCart();
      }));
      cartTotalEl.textContent = rupiah(total);
    }

    function renderOrders(){
      ordersListEl.innerHTML='';
      if(orders.length===0){ ordersListEl.innerHTML = '<div class="muted">Belum ada pembelian.</div>'; return }
      orders.forEach(o=>{
        const div = document.createElement('div'); div.style.marginBottom='10px';
        div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${escapeHtml(o.email)}</strong><div class="muted">${new Date(o.createdAt).toLocaleString()}</div></div><div style="text-align:right">${rupiah(o.total)}</div></div>`;
        // list download links
        const list = document.createElement('div'); list.style.marginTop='8px';
        o.items.forEach(it=>{
          const a = document.createElement('div');
          a.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><div><small>${escapeHtml(it.title)} • ${escapeHtml(it.filename)}</small></div><div><a href="${it.url}" download="${escapeHtml(it.filename)}" target="_blank">Unduh</a></div></div>`;
          list.appendChild(a);
        })
        div.appendChild(list);
        ordersListEl.appendChild(div);
      })
    }

    function addToCart(id){ cart.push(id); renderCart(); }

    checkoutForm.addEventListener('submit', function(e){
      e.preventDefault();
      if(cart.length===0){ alert('Keranjang kosong'); return }
      const email = buyerEmail.value.trim(); if(!email){ alert('Masukkan email'); return }
      // simulate payment process
      const items = cart.map(id=>{
        const p = products.find(x=>x.id===id);
        return {id:p.id,title:p.title,filename:p.filename, price:p.price}
      });
      const total = items.reduce((s,i)=>s+Number(i.price),0);

      // create download URLs from blobMap; if a product's blob missing, skip
      const purchased = [];
      items.forEach(it=>{
        const b = blobMap[it.id];
        if(b && b.blob){
          // create new object URL so link is stable
          const url = URL.createObjectURL(b.blob);
          // schedule revoke after 10 minutes (600k ms)
          setTimeout(()=>{ try{ URL.revokeObjectURL(url) }catch(e){} }, 600000);
          purchased.push({id:it.id,title:it.title,filename:it.filename,url,price:it.price});
        }
      });

      const order = {id: 'ORD'+Date.now(), email, items:purchased, total, createdAt:Date.now()};
      orders.unshift(order);
      sessionStorage.setItem('demo_orders', JSON.stringify(orders));
      cart = [];
      renderCart(); renderOrders();
      alert('Pembelian berhasil! Link unduh tersedia pada bagian Riwayat Pembelian untuk sesi ini.');
    });

    // Admin toggle
    toggleAdminBtn.addEventListener('click', ()=>{
      if(adminPanel.style.display==='none'){ adminPanel.style.display='block'; toggleAdminBtn.textContent='Sembunyikan Admin' }
      else { adminPanel.style.display='none'; toggleAdminBtn.textContent='Mode Admin' }
    });

    // Add product form handler
    addProductForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const title = document.getElementById('prod-title').value.trim();
      const price = Number(document.getElementById('prod-price').value) || 0;
      const fileInput = document.getElementById('prod-file');
      if(!fileInput.files.length){ alert('Pilih file'); return }
      const file = fileInput.files[0];
      const id = 'P' + Date.now() + Math.floor(Math.random()*999);
      // store blob in memory
      const blob = file.slice(0, file.size, file.type);
      blobMap[id] = {blob, filename: file.name};
      products.unshift({id,title,price,filename:file.name,filesize:file.size});
      saveProducts(); renderProducts();
      fileInput.value=''; document.getElementById('prod-title').value=''; document.getElementById('prod-price').value='';
      alert('Produk ditambahkan (disimpan di memori browser).');
    });

    // On load: if localStorage has products metadata but no blobs (new session), warn user
    if(products.length>0){
      // rehydrate products array to include any missing fields
      // Note: blobs will be missing on fresh page load — files added in previous sessions won't have file content.
      renderProducts();
    }

    // If there are saved orders in session storage, rehydrate
    if(orders.length>0) renderOrders();

    // initial render
    renderProducts(); renderCart();

    // small util to escape html in strings
    function escapeHtml(unsafe){ return (unsafe+'').replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m] }); }

  </script></body>
</html>
